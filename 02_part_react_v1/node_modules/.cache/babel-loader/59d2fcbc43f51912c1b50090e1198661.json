{"ast":null,"code":"import { userAPI } from '../api/api';\nconst FOLLOW = 'FOLLOW',\n      UNFOLLOW = 'UNFOLLOW',\n      SET_USERS = 'SET_USERS',\n      SET_CURRENT_PAGE = 'SET_CURRENT_PAGE',\n      SET_TOTAL_USERS_COUNT = 'SET_TOTAL_USERS_COUNT',\n      TOGGLE_IS_FETCHING = 'TOGGLE_IS_FETCHING',\n      TOGGLE_IS_FOLLOWING_PROGRESS = 'TOGGLE_IS_FOLLOWING_PROGRESS';\nconst initialState = {\n  users: [],\n  pageSize: 10,\n  //limit users\n  totalUsersCount: 0,\n  currentPage: 1,\n  isFetching: false,\n  followingInProgress: []\n};\n\nconst usersReducer = function () {\n  let state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialState;\n  let action = arguments.length > 1 ? arguments[1] : undefined;\n\n  if (action.type === FOLLOW) {\n    const stateCopy = { ...state,\n      users: state.users.map( //возвр новый объект\n      user => {\n        return user.id === action.userID ? { ...user,\n          followed: true\n        } : user;\n      })\n    }; //debugger\n\n    return stateCopy;\n  }\n\n  if (action.type === UNFOLLOW) {\n    const stateCopy = { ...state,\n      users: state.users.map( //возвр новый объект\n      user => {\n        return user.id === action.userID ? { ...user,\n          followed: false\n        } : user;\n      })\n    }; //debugger\n\n    return stateCopy;\n  }\n\n  if (action.type === SET_USERS) {\n    const stateCopy = { //...state, users: [...state.users, ...action.users]\n      ...state,\n      users: action.users\n    }; //debugger\n\n    return stateCopy;\n  }\n\n  if (action.type === SET_TOTAL_USERS_COUNT) {\n    const showCounts = () => action.totalCount > 50 ? 50 : action.totalCount;\n\n    const stateCopy = { //...state, users: [...state.users, ...action.users]\n      ...state,\n      totalUsersCount: showCounts()\n    }; //debugger\n\n    return stateCopy;\n  }\n\n  if (action.type === SET_CURRENT_PAGE) {\n    //debugger\n    const stateCopy = { ...state,\n      currentPage: action.currentPage\n    }; //debugger\n\n    return stateCopy;\n  }\n\n  if (action.type === TOGGLE_IS_FETCHING) {\n    //debugger\n    const stateCopy = { ...state,\n      isFetching: action.isFetching\n    }; //debugger\n\n    return stateCopy;\n  }\n\n  if (action.type === TOGGLE_IS_FOLLOWING_PROGRESS) {\n    //debugger\n    //console.log('state.followingInProgress2: ' + window.store.getState().usersPage)\n    const stateCopy = { ...state,\n      followingInProgress: action.isFetching ? [action.isFetching, action.userId] : []\n    }; //debugger\n\n    return stateCopy;\n  }\n\n  return state;\n};\n\nexport const follow = userID => ({\n  type: FOLLOW,\n  userID\n}); //create action.type, action.userID\n\nexport const unfollow = userID => ({\n  type: UNFOLLOW,\n  userID\n}); //create action.type, action.userID\n\nexport const setUsers = users => ({\n  type: SET_USERS,\n  users\n}); //create action.type, action.users\n\nexport const setCurrentPage = currentPage => ({\n  type: SET_CURRENT_PAGE,\n  currentPage\n});\nexport const setTotalUsersCount = totalCount => ({\n  type: SET_TOTAL_USERS_COUNT,\n  totalCount\n});\nexport const setIsFetching = isFetching => ({\n  type: TOGGLE_IS_FETCHING,\n  isFetching\n});\nexport const setIsFollowingProgress = (isFetching, userId) => ({\n  type: TOGGLE_IS_FOLLOWING_PROGRESS,\n  isFetching,\n  userId\n}); //****middle ware****\n\nexport const getUsersThunkCreator = (currentPage, pageSize) => {\n  //debugger\n  return dispatch => {\n    //this.props.setIsFetching (true)\n    dispatch(setIsFetching(true));\n    userAPI.getUsers(currentPage, pageSize) //from api\n\n    /* \n    const httpQuery = `https://social-network.samuraijs.com/api/1.0/users?page=${this.props.currentPage}&count=${this.props.pageSize}`;\n    axios.get(httpQuery,{withCredentials: true}) */\n    .then(data => {\n      //this.props.setIsFetching (false)\n      dispatch(setIsFetching(false)); //this.props.setUsers(extractData);\n\n      dispatch(setUsers(data.items)); //this.props.setTotalUsersCount(data.totalCount);\n\n      dispatch(setTotalUsersCount(data.totalCount));\n    }); //this.props.setUsers([]);\n    // dispatch(setUsers([]));\n  };\n};\nexport default usersReducer;","map":{"version":3,"names":["userAPI","FOLLOW","UNFOLLOW","SET_USERS","SET_CURRENT_PAGE","SET_TOTAL_USERS_COUNT","TOGGLE_IS_FETCHING","TOGGLE_IS_FOLLOWING_PROGRESS","initialState","users","pageSize","totalUsersCount","currentPage","isFetching","followingInProgress","usersReducer","state","action","type","stateCopy","map","user","id","userID","followed","showCounts","totalCount","userId","follow","unfollow","setUsers","setCurrentPage","setTotalUsersCount","setIsFetching","setIsFollowingProgress","getUsersThunkCreator","dispatch","getUsers","then","data","items"],"sources":["/home/roman/wwwl/085_react/react_kabzda2/src/redux/reducer-users.js"],"sourcesContent":["import {userAPI} from '../api/api'\n\nconst FOLLOW = 'FOLLOW', \n      UNFOLLOW = 'UNFOLLOW', \n      SET_USERS = 'SET_USERS',\n      SET_CURRENT_PAGE = 'SET_CURRENT_PAGE',\n      SET_TOTAL_USERS_COUNT = 'SET_TOTAL_USERS_COUNT',\n      TOGGLE_IS_FETCHING = 'TOGGLE_IS_FETCHING',\n      TOGGLE_IS_FOLLOWING_PROGRESS = 'TOGGLE_IS_FOLLOWING_PROGRESS';\n\nconst initialState = {\n  users:[],\n  pageSize: 10, //limit users\n  totalUsersCount: 0,\n  currentPage: 1,\n  isFetching: false,\n  followingInProgress: []\n}\n\nconst usersReducer = (state=initialState, action) => {\n    if (action.type === FOLLOW) {\n      \n        const stateCopy = { \n            ...state, \n            users: state.users.map ( //возвр новый объект\n                user => { \n                  return (user.id === action.userID) ? {...user,followed: true} : user;\n                }\n            )\n        }\n        //debugger\n        return stateCopy\n    }\n    if (action.type === UNFOLLOW) {\n      \n        const stateCopy = { \n            ...state, \n            users: state.users.map ( //возвр новый объект\n                user => { \n                    return (user.id === action.userID) ? {...user,followed: false} : user;\n                }\n            )\n        }\n        //debugger\n        return stateCopy\n    }\n    if (action.type === SET_USERS) {\n        const stateCopy = { \n            //...state, users: [...state.users, ...action.users]\n            ...state, users: action.users\n        }\n        //debugger\n        return stateCopy\n    }\n    if (action.type === SET_TOTAL_USERS_COUNT) {\n        const showCounts = () => action.totalCount > 50 ? 50 : action.totalCount;\n        const stateCopy = { \n            //...state, users: [...state.users, ...action.users]\n            ...state, totalUsersCount: showCounts()\n        }\n        //debugger\n        return stateCopy\n    }\n    if (action.type === SET_CURRENT_PAGE) {\n        //debugger\n        const stateCopy = { \n            ...state, currentPage: action.currentPage\n        }\n        //debugger\n        return stateCopy\n    }    \n    if (action.type === TOGGLE_IS_FETCHING) {\n        //debugger\n        const stateCopy = { \n            ...state, isFetching: action.isFetching\n        }\n        //debugger\n        return stateCopy\n    }  \n    if (action.type === TOGGLE_IS_FOLLOWING_PROGRESS) {\n        //debugger\n         //console.log('state.followingInProgress2: ' + window.store.getState().usersPage)\n        const stateCopy = { \n            ...state, \n            followingInProgress: action.isFetching \n            ? [action.isFetching, action.userId]\n            : []\n        }\n        //debugger\n        return stateCopy\n    }  \n    \n    return state\n}\n\nexport const follow = (userID) => ({ type: FOLLOW, userID}); //create action.type, action.userID\nexport const unfollow = (userID) => ({ type: UNFOLLOW, userID});//create action.type, action.userID\nexport const setUsers = users => ({ type: SET_USERS, users});//create action.type, action.users\nexport const setCurrentPage = currentPage => ({ type: SET_CURRENT_PAGE, currentPage});\nexport const setTotalUsersCount = totalCount => ({ type: SET_TOTAL_USERS_COUNT, totalCount});\nexport const setIsFetching = isFetching => ({ type: TOGGLE_IS_FETCHING, isFetching});\nexport const setIsFollowingProgress = (isFetching, userId) => ({ type: TOGGLE_IS_FOLLOWING_PROGRESS, isFetching, userId});\n\n//****middle ware****\nexport const getUsersThunkCreator = (currentPage, pageSize) =>{\n    //debugger\n    \n   return (dispatch) => {\n        //this.props.setIsFetching (true)\n        dispatch(setIsFetching (true))\n    \n        userAPI.getUsers(currentPage, pageSize) //from api\n        /* \n        const httpQuery = `https://social-network.samuraijs.com/api/1.0/users?page=${this.props.currentPage}&count=${this.props.pageSize}`;\n        axios.get(httpQuery,{withCredentials: true}) */\n        .then((data) => {\n          //this.props.setIsFetching (false)\n          dispatch(setIsFetching (false))\n          //this.props.setUsers(extractData);\n          dispatch(setUsers(data.items));\n          //this.props.setTotalUsersCount(data.totalCount);\n          dispatch(setTotalUsersCount(data.totalCount));\n        });\n        //this.props.setUsers([]);\n       // dispatch(setUsers([]));\n    }\n}\n\nexport default usersReducer"],"mappings":"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"},"metadata":{},"sourceType":"module"}